<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.31" />
  <meta name="author" content="Justin Dixon">

  
  
  
  
    
      
    
  
  <meta name="description" content="Have you been struggling to learn about what decision trees are? Finding it difficult to link pictures of trees with machine learning algorithms? If you answered yes to these questions then this post is for you.
Decision trees are an amazingly powerful predictive machine learning method that all Data Analysts should know. When I was researching tree-based methods I could never find a hand worked problem. Most other souces simply list the maths, or show the results of a grown tree.">

  
  <link rel="alternate" hreflang="en-us" href="/post/2018-01-22-decisioin-trees/">

  


  

  
  
  <meta name="theme-color" content="#0095eb">
  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-92183872-2', 'auto');
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Justin Dixon">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Justin Dixon">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/2018-01-22-decisioin-trees/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@JustinTheDixon">
  <meta property="twitter:creator" content="@JustinTheDixon">
  
  <meta property="og:site_name" content="Justin Dixon">
  <meta property="og:url" content="/post/2018-01-22-decisioin-trees/">
  <meta property="og:title" content="Decision Trees | Justin Dixon">
  <meta property="og:description" content="Have you been struggling to learn about what decision trees are? Finding it difficult to link pictures of trees with machine learning algorithms? If you answered yes to these questions then this post is for you.
Decision trees are an amazingly powerful predictive machine learning method that all Data Analysts should know. When I was researching tree-based methods I could never find a hand worked problem. Most other souces simply list the maths, or show the results of a grown tree.">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2018-01-31T21:13:14-05:00">
  
  <meta property="article:modified_time" content="2018-01-31T21:13:14-05:00">
  

  

  <title>Decision Trees | Justin Dixon</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">Justin Dixon</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#publications_selected">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <h1 itemprop="name">Decision Trees</h1>

    

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2018-01-31 21:13:14 -0500 -0500" itemprop="datePublished dateModified">
      Jan 31, 2018
    </time>
  </span>
  <span itemscope itemprop="author publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Justin Dixon">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    12 min read
  </span>
  

  
  
  <span class="middot-divider"></span>
  <a href="/post/2018-01-22-decisioin-trees/#disqus_thread"></a>
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="/categories/data-analysis">Data Analysis</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Decision%20Trees&amp;url=%2fpost%2f2018-01-22-decisioin-trees%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2f2018-01-22-decisioin-trees%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2f2018-01-22-decisioin-trees%2f&amp;title=Decision%20Trees"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2f2018-01-22-decisioin-trees%2f&amp;title=Decision%20Trees"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Decision%20Trees&amp;body=%2fpost%2f2018-01-22-decisioin-trees%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


    <div class="article-style" itemprop="articleBody">
      <p>Have you been struggling to learn about what decision trees are? Finding it difficult to link pictures of trees with machine learning algorithms? If you answered yes to these questions then this post is for you.</p>
<p>Decision trees are an amazingly powerful predictive machine learning method that all Data Analysts should know. When I was researching tree-based methods I could never find a hand worked problem. Most other souces simply list the maths, or show the results of a grown tree. To truly understand the method though I needed to see how trees are actually grown! So I worked it out and now to save time for you I have put my working into this post.</p>
<p>The majority of the theory involved in this post is thanks to this paper <span class="citation">(Breiman et al. 1984)</span> whilst the mathematics is taken from <span class="citation">(Friedman, Hastie, and Tibshirani 2001)</span>.</p>
<p>The structure of this post follows closely to how I learn, and how I hope you learn! First I will list examples of how decision trees have been used and their advantages and disadvantages. Next Ill present a worked example and following will be an example of classification and regression example.</p>
<div id="examples" class="section level1">
<h1>Examples</h1>
<p>Decision Trees are used in a wide variety of fields! These examples are in credit to <a href="https://github.com/michaeldorner/DecisionTrees">Micheal Dorner</a>. I have used decision trees in my Masters thesis too.</p>
<ul>
<li><strong>Astronomy:</strong> Distinguishing between stars and cosmic rays in images collected by the Hubble Space Telescope.</li>
<li><strong>Medicine:</strong> Diagnosis of the ovarian cancer.</li>
<li><strong>Economy:</strong> Stock trading.</li>
<li><strong>Geography:</strong> To predict and correct errors in topographical and geological data.</li>
<li><strong>Personally:</strong> Predict the probabilities of winning for teams in professional Dota 2 matches.</li>
</ul>
</div>
<div id="table-of-advantages-and-disadvantages" class="section level1">
<h1>Table of advantages and disadvantages</h1>
<center>
<table style="width:78%;">
<colgroup>
<col width="37%" />
<col width="40%" />
</colgroup>
<thead>
<tr class="header">
<th>Advantages</th>
<th align="center">Disadvantages</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Easy to understand</td>
<td align="center">Overfits the training data</td>
</tr>
<tr class="even">
<td>Resistant to outliers and weak features</td>
<td align="center">Stuggles with continuous depedent variables</td>
</tr>
<tr class="odd">
<td>Easy to implement in practice</td>
<td align="center">Need important variables</td>
</tr>
<tr class="even">
<td>Can handle datasets with missing values and errors</td>
<td align="center">Trees are unstable</td>
</tr>
<tr class="odd">
<td>Makes no assumptions about the underlying distributions</td>
<td align="center">Lack of smoothness</td>
</tr>
</tbody>
</table>
</center>
<p>Advantages:</p>
<ul>
<li><strong>Easy to understand:</strong> When a decision tree is constructed you can view the decision rules in a nice looking tree diagram, hence the name!</li>
<li><strong>Resistant to outliers and weak features:</strong> The splitting criteria does not care greatly how far values are from the decision boundary. The splitting criteria splits according the strongest features first which minimises the harm of the weak features (the weak features are splitting already split data = smaller effect).</li>
<li><strong>Easy to implement in practice:</strong> As the model is resistant to outliers and weak features in practice you do not need to spend as much time testing different feature input combinations.</li>
<li><strong>Can handle datasets with missing values and errors:</strong> Similar to being resistant to outliers and weak features.</li>
<li><strong>Makes no assumptions about the underlying distributions:</strong> This may not so important in practice but it makes the model theorectically more appealing.</li>
</ul>
<p>Disadvantages:</p>
<ul>
<li><strong>Overfits the training data</strong>: This is a very large issue but can be minimised using random forests. Which we will cover in the next post.</li>
<li><strong>Stuggles with continuous depedent variables:</strong> Due to the leafs containing several observations which are averaged the prediction space is not smooth. This makes highly accurate regression predictions difficult to achieve.<br />
</li>
<li><strong>Need important variables:</strong> Without strong predictors tree based methods lose many of their strengths.</li>
<li><strong>Trees are unstable:</strong> The structure of an estimated tree can vary significantly between different estimations.</li>
</ul>
</div>
<div id="the-algorithm" class="section level1">
<h1>The Algorithm</h1>
<ol style="list-style-type: decimal">
<li>Start at the root node.</li>
<li>For each input, find the set <span class="math inline">\(S\)</span> that minimizes the sum of the node impurities in the two child nodes and choose the split <span class="math inline">\(\{X \in S \}\)</span> that gives the minimum overall <span class="math inline">\(X\)</span> and <span class="math inline">\(S\)</span>.</li>
<li>If a stopping criterion is reached, exit. Otherwise, apply step 2 to each child node in turn.</li>
</ol>
<p>In simplier words to build the tree you need to decide where the splits(branches) are going to happen. You need to calculate for each possible split for each input variable an ‘impurity’ measure. For classification trees this impurity measure can be the Gini Index. This is just a measure that says how well the split divides the data. The smallest impurity score is where the split will happen.</p>
<p>After you have divided the data into two regions you continue to split those regions again and again until you reach some stopping rule. Once the stopping rule is reached it is possible to <em>prune</em> the tree. This is typically done occuring to some <em>cost complexity</em> measure where non-terminal splits can be removed.</p>
<div id="splitting-criteria---gini-impurity" class="section level2">
<h2>Splitting criteria - Gini Impurity</h2>
<p>There are several splitting criteria that can be used but I will be using the Gini method for this worked example. We can define the Gini Impuirty as:</p>
<p><span class="math display">\[ GiniImpurity = \sum_{k \neq k&#39;} \hat{p}_{mk}\hat{p}_{mk&#39;} = \sum^{K}_{k=1} \hat{p}_{mk}(1-\hat{p}_{mk}) \]</span> where</p>
<p><span class="math display">\[ \hat{p}_{mk} = \frac{1}{N_{m}}\sum_{x_{i}\in R_{m}} I(y_{i} = k)  \]</span> and</p>
<p><span class="math display">\[ N_{i} = \#\{x_{i} \in R_{m} \} \]</span> and</p>
<p><span class="math display">\[ R_{1}(j,s) = \{X|X \leq s \} \]</span></p>
<p><span class="math display">\[R_{2}(j,s) = \{X|X &gt; s \} \]</span></p>
</div>
<div id="stopping-criteria---minimum-leaf-size" class="section level2">
<h2>Stopping criteria - Minimum Leaf Size</h2>
<p>There are several possible rules for when the splitting algorithm should stop. These possibilities include:</p>
<ul>
<li>If a split region only has identical values of the dependent variable then that region will not be split any futher.<br />
</li>
<li>If all cases in a node have identical values for each predictor, the node will not be split.<br />
</li>
<li>If the current tree depth reaches the user-specified maximum tree depth limit value, the tree growing process will stop.<br />
</li>
<li>If the size of a node is less than the user-specified minimum node size value, the node will not be split.</li>
<li>If the split of a node results in a child node whose node size is less than the user-specified minimum child node size value, the node will not be split.</li>
</ul>
<p>Other stopping criteria could include an error minimisation rule, but this tends to miss important splits that could happen. That is why it is preferable to grow the tree and then prune it back to an acceptable level. For this tutorial a minimum leaf size of 5 was chosen.</p>
</div>
<div id="prunning-criteria---misclarification-rate" class="section level2">
<h2>Prunning Criteria - Misclarification Rate</h2>
<p><span class="math display">\[ \frac{1}{N_{m}} \sum_{i \in R_{m}} I(y_{i} \neq k(m)) = 1 - \hat{p}_{mk(m)} \]</span> where</p>
<p><span class="math display">\[ k(m) = argmax_{k}\hat{p}_{mk} \]</span></p>
</div>
</div>
<div id="worked-example" class="section level1">
<h1>Worked Example</h1>
<p>Let us begin with a worked simple example. It always helps to understand the intuition to see the basics of the method being used.</p>
<p>Lets us build a simple dataset to work the problem by hand. The dataset will be ten observations of two classes, 0 or 1, with two predictors, X1 and X2.</p>
<pre class="r"><code>Class &lt;- as.factor(c(0,0,0,0,0,1,1,1,1,1)) # The 2 class vector
X1 &lt;- c(4,4.5,5,5.5,3,5.6,6,6.5,6.2,5.9) # Random values for predictor 1
X2&lt;- c(9,10,11,10,9,8,7,8,7,8) # Similarly
df &lt;- cbind.data.frame(Class, X1, X2) # Combine the class vector and the two predictors</code></pre>
<pre class="r"><code>ggplot(data = df, aes(x = X1, y=X2)) + # Plot the two predictors and colour the 
  ggtitle(label = &quot;The two Predictors with their assoicated Class values&quot;) +
  geom_point(aes(color=Class), size = 6, alpha = .5) # observations according to which class they belong</code></pre>
<p><img src="/post/2018-01-22-decisioin-trees_files/figure-html/unnamed-chunk-2-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>From the graph it is obvious how to split the data but lets us worked it out using the algorithm to see how it works. First we will calculate the Gini Impurity for each possible split in the range of each predictor.</p>
<pre class="r"><code>Predictor1test &lt;- seq(from = 3, to = 7, by  = 0.1) # The potential splits where we calculate the Gini Impurity
Predictor2test &lt;- seq(from =7, to = 11, by = 0.1) # Similar for Predictor 2
CalculateP &lt;- function(i, index, m, k) { # Function to calculate the proportion of observations in the split
  if(m==&quot;L&quot;) {                          # region (m) which match to class (k) 
    Nm &lt;- length(df$Class[which(df[,index] &lt;= i)]) # The number of observations in the split region Rm
    Count &lt;- df$Class[which(df[,index] &lt;= i)] == k # The number of observations that match the class k
  } else {
    Nm &lt;- length(df$Class[which(df[,index] &gt; i)])
    Count &lt;- df$Class[which(df[,index] &gt; i)] == k
  } 
  P &lt;- length(Count[Count==TRUE]) / Nm # Proportion calculation
  return(c(P,Nm)) # Returns both the porportion and the number of observations
}
CalculateGini &lt;- function(x, index) { # Function to calculate the Gini Impurity
  Gini &lt;- NULL # Create the Gini variables
  for(i in x) {
    pl0 &lt;- CalculateP(i, index, &quot;L&quot;, 0) # Proportion in the left region with class 0
    pl1 &lt;- CalculateP(i, index, &quot;L&quot;, 1)
    GiniL &lt;- pl0[1]*(1-pl0[1]) + pl1[1]*(1-pl1[1]) # The Fini for the left region
    pr0 &lt;- CalculateP(i, index, &quot;R&quot;, 0)
    pr1 &lt;- CalculateP(i, index, &quot;R&quot;, 1)
    GiniR &lt;- pr0[1]*(1-pr0[1]) + pr1[1]*(1-pr1[1])
    Gini &lt;- rbind(Gini, sum(GiniL * pl0[2]/(pl0[2] + pr0[2]),GiniR * pr0[2]/(pl0[2] + pr0[2]), na.rm = TRUE)) # Need to weight both left and right Gini scores when combining both
  }
  return(Gini)
}
Gini &lt;- CalculateGini(Predictor1test, 2)
Predictor1test&lt;- cbind.data.frame(Predictor1test, Gini)
Gini &lt;- CalculateGini(Predictor2test, 3)
Predictor2test&lt;- cbind.data.frame(Predictor2test, Gini)</code></pre>
<pre class="r"><code>ggplot(data = Predictor1test, aes(x=Predictor1test, y=Gini)) + 
  ggtitle(&quot;Gini Index For Possible Values Of X1&quot;) +
  geom_line()</code></pre>
<p><img src="/post/2018-01-22-decisioin-trees_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We can see that the most pure split for predictor1 is at 5.5. All other splits leave some impurity in the resulting spaces.</p>
<pre class="r"><code>ggplot(data = Predictor2test, aes(x=Predictor2test, y=Gini)) + 
  ggtitle(&quot;Gini Index For Possible Values Of X2&quot;) +
  geom_line()</code></pre>
<p><img src="/post/2018-01-22-decisioin-trees_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Here we can see a region where the Gini Impurity is minimised. Any value here would be suitable. Now we can observe a hand calculation of the Gini Impurity for X1 = 5.5.</p>
<center>
<img src="/img/ginipart1.png" alt="optional caption text" />
</center>
<center>
<img src="/img/ginipart2.png" alt="optional caption text" />
</center>
<p>With a minimum off 5 observations per leaf we are already at the stopping criteria but let us see the misclassification for each off our potential stopping criteria for the sake of illumination. Also due to the purity of the split we do not need to prune the tree.</p>
<pre class="r"><code>CalculatePkm &lt;- function(i, index, m) { # This is different to the other P function is that it calculates the proportion to
  if(m==&quot;L&quot;) {                          # only the majority class
    Nm &lt;- length(df$Class[which(df[,index] &lt;= i)]) 
    Km &lt;- as.integer(names(sort(table(df$Class[which(df[,index] &lt;= i)]), decreasing = TRUE)[1]))
    Count &lt;- df$Class[which(df[,index] &lt;= i)] == Km
  } else {
    Nm &lt;- length(df$Class[which(df[,index] &gt; i)])
    Km &lt;- as.integer(names(sort(table(df$Class[which(df[,index] &gt; i)]), decreasing = TRUE)[1]))
    Count &lt;- df$Class[which(df[,index] &gt; i)] == Km
  } 
  P &lt;- length(Count[Count==TRUE]) / Nm
  return(c(P,Nm))
}
CalculateMissClass &lt;- function(x, index) {
  miserr &lt;- NULL
  for(i in x) {
    pLkm &lt;- CalculatePkm(i, index, &quot;L&quot;)
    missclassL &lt;- (1 - pLkm[1])
    pRkm &lt;- CalculatePkm(i, index, &quot;R&quot;)
    missclassR &lt;- (1 - pRkm[1])
    miserr &lt;- rbind(miserr,  sum(missclassL * pLkm[2]/(pLkm[2] + pRkm[2]),missclassR * pRkm[2]/(pLkm[2] + pRkm[2]), na.rm = TRUE))
  }
  return(miserr)
}
miserr &lt;- CalculateMissClass(Predictor1test[,1], 2)
Predictor1test&lt;- cbind.data.frame(Predictor1test, miserr)
miserr &lt;- CalculateMissClass(Predictor2test[,1], 3)
Predictor2test&lt;- cbind.data.frame(Predictor2test, miserr)</code></pre>
<pre class="r"><code>ggplot(data = Predictor1test, aes(x=Predictor1test, y=miserr)) + 
  ggtitle(&quot;Misclassification Error for X1&quot;) +
  geom_line()</code></pre>
<p><img src="/post/2018-01-22-decisioin-trees_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggplot(data = Predictor2test, aes(x=Predictor2test, y=miserr)) + 
  ggtitle(&quot;Misclassification Error for X2&quot;) +
  geom_line()</code></pre>
<p><img src="/post/2018-01-22-decisioin-trees_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Similar to the case with the Gini Impurity we can see the regions where the measure is minimised. Now we can go through a hand drawn problem and see the calculation in action.</p>
<center>
<img src="/img/misclasspart1.png" alt="optional caption text" />
</center>
<center>
<img src="/img/misclasspart2.png" alt="optional caption text" />
</center>
<p>Now with such a small dataset it does not make sense to prune the tree but let us continue to see an example with real data.</p>
</div>
<div id="example-classification-tree" class="section level1">
<h1>Example: Classification Tree</h1>
<p>For this example we will use the iris dataset that comes packed with R. There are three species of the iris flower: setosa, versicolor, and virgincia. We will use the classification tree process to separate the feaures of Sepal Length, Sepal Width, Pdeal Length, and Petal Width.</p>
<div id="species-of-iris-with-each-predictor-combination" class="section level2">
<h2>Species of Iris with each Predictor Combination</h2>
<center>
<img src="/img/IrisInitial.gif" alt="Iris data plotted with each combination of predictor" />
</center>
<p>From the data you can see that Setosa can be separated easily from the other two species. Try it yourself, where would you draw the line to separate Setosa?</p>
</div>
<div id="build-the-tree" class="section level2">
<h2>Build the tree</h2>
<p>Now that we have worked through how the classification tree is grown we can resort to using already established packages to estimate our decision tree for us. I will be using the rpart package for this post but there are many other packages that can estimate trees.</p>
<pre class="r"><code>Tree &lt;- rpart(Species ~ ., data=iris, parms = list(split = &#39;gini&#39;) )</code></pre>
</div>
<div id="the-splits" class="section level2">
<h2>The Splits</h2>
<p>The tree growing process can involve many more splits than the single split from our hand worked problem. Here we can see all the splits that were done when growing this tree.</p>
<pre class="r"><code>kable(Tree$splits, digits = 2, format = &#39;markdown&#39;)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">count</th>
<th align="right">ncat</th>
<th align="right">improve</th>
<th align="right">index</th>
<th align="right">adj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Petal.Length</td>
<td align="right">150</td>
<td align="right">-1</td>
<td align="right">50.00</td>
<td align="right">2.45</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">Petal.Width</td>
<td align="right">150</td>
<td align="right">-1</td>
<td align="right">50.00</td>
<td align="right">0.80</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">Sepal.Length</td>
<td align="right">150</td>
<td align="right">-1</td>
<td align="right">34.16</td>
<td align="right">5.45</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">Sepal.Width</td>
<td align="right">150</td>
<td align="right">1</td>
<td align="right">19.04</td>
<td align="right">3.35</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">Petal.Width</td>
<td align="right">0</td>
<td align="right">-1</td>
<td align="right">1.00</td>
<td align="right">0.80</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">Sepal.Length</td>
<td align="right">0</td>
<td align="right">-1</td>
<td align="right">0.92</td>
<td align="right">5.45</td>
<td align="right">0.76</td>
</tr>
<tr class="odd">
<td align="left">Sepal.Width</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.83</td>
<td align="right">3.35</td>
<td align="right">0.50</td>
</tr>
<tr class="even">
<td align="left">Petal.Width</td>
<td align="right">100</td>
<td align="right">-1</td>
<td align="right">38.97</td>
<td align="right">1.75</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">Petal.Length</td>
<td align="right">100</td>
<td align="right">-1</td>
<td align="right">37.35</td>
<td align="right">4.75</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">Sepal.Length</td>
<td align="right">100</td>
<td align="right">-1</td>
<td align="right">10.69</td>
<td align="right">6.15</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">Sepal.Width</td>
<td align="right">100</td>
<td align="right">-1</td>
<td align="right">3.56</td>
<td align="right">2.45</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">Petal.Length</td>
<td align="right">0</td>
<td align="right">-1</td>
<td align="right">0.91</td>
<td align="right">4.75</td>
<td align="right">0.80</td>
</tr>
<tr class="odd">
<td align="left">Sepal.Length</td>
<td align="right">0</td>
<td align="right">-1</td>
<td align="right">0.73</td>
<td align="right">6.15</td>
<td align="right">0.41</td>
</tr>
<tr class="even">
<td align="left">Sepal.Width</td>
<td align="right">0</td>
<td align="right">-1</td>
<td align="right">0.67</td>
<td align="right">2.95</td>
<td align="right">0.28</td>
</tr>
</tbody>
</table>
<p>There are quite a few splits here! So let us look at the two most important splits, Petal.Length = 2.5 and Petal.Width = 0.8.</p>
<div id="where-the-split-happens-with-petallength-2.5" class="section level3">
<h3>Where the split happens with PetalLength = 2.5</h3>
<center>
<img src="/img/PetalLength.gif" alt="Where the split happens with PetalLength = 2.5" />
</center>
</div>
<div id="where-the-splits-occure-when-petalwidth-0.8" class="section level3">
<h3>Where the splits occure when PetalWidth = 0.8</h3>
<center>
<img src="/img/PetalWidth.gif" alt="Where the splits occure when PetalWidth = 0.8" />
</center>
</div>
</div>
<div id="the-final-pruned-tree" class="section level2">
<h2>The Final Pruned Tree</h2>
<pre class="r"><code>rpart.plot(Tree)</code></pre>
<p><img src="/post/2018-01-22-decisioin-trees_files/figure-html/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>This is the final tree diagram. You may notice that the tree has been pruned to have only 2 split nodes. Indeed can see that the split for Petal.Width is moved to 1.8 instead of at 0.8 in the final decision tree.</p>
</div>
</div>
<div id="example-regression-tree" class="section level1">
<h1>Example: Regression Tree</h1>
<p>For this example I will be providing less explanation.</p>
<div id="splitting-criteria---minimising-the-sum-of-squares" class="section level2">
<h2>Splitting Criteria - Minimising The Sum Of Squares</h2>
<p><span class="math display">\[ \min_{j,s} [\min_{c1} \sum_{x_{i} \in R_{1}(j,s)}(y_{i} -c_{1})^2 +  \min_{c2} \sum_{x_{i} \in R_{2}(j,s)}(y_{i} -c_{2})^2 ] \]</span></p>
<p>where</p>
<p><span class="math display">\[ \hat{c}_{m} = \frac{1}{N_{m}} \sum_{x_{i} \in R_{m}} y_{i} \]</span> The equation calculates, for each variable, the sum of squared errors. The value for <span class="math inline">\(c_{m}\)</span> is simply the average observation value in that region. The algoirthm then finds the smallest sum of squares for that variable and does that for each variable. The algorithm finally compares the champion split from each variable to determine the winner for the overall split to occur. The stopping criteria will once again be a minimum size of terminal nodes to be 5.</p>
</div>
<div id="pruning-criteria---cost-complexity-criteria" class="section level2">
<h2>Pruning Criteria - Cost Complexity Criteria</h2>
<p>Let:</p>
<p><span class="math display">\[ Q_{m}(T) = \frac{1}{N_{m}} \sum_{x_{i} \in R_{m}} (y_{i} - \hat{c}_{m})^2 \]</span></p>
<p>we may then define cost complexity criterion as:</p>
<p><span class="math display">\[ C_{\alpha}(T) = \sum^{|T|}_{m=1} N_{m}Q_{m}(T) + \alpha|T| \]</span></p>
<p>Our goal is to minimise this function. The compromise between tree size and its fit to the data is dictated by <span class="math inline">\(\alpha\)</span>. Smaller values lead to larger trees and larger values lead to more pruning.</p>
<p>There are processes by which to estimate <span class="math inline">\(\alpha\)</span> but we will not go into that today.</p>
</div>
<div id="the-data-usa-arrests" class="section level2">
<h2>The Data: USA Arrests</h2>
<pre class="r"><code>ggplot(data = USArrests, aes(x = Assault, y = UrbanPop)) + 
  geom_point(aes(color=Murder), size = 6, alpha = .5)</code></pre>
<p><img src="/post/2018-01-22-decisioin-trees_files/figure-html/unnamed-chunk-15-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>RegressionTree &lt;- rpart(Murder~ Assault + UrbanPop, data=USArrests)
kable(RegressionTree$splits, digits = 2, format = &#39;markdown&#39;)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">count</th>
<th align="right">ncat</th>
<th align="right">improve</th>
<th align="right">index</th>
<th align="right">adj</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Assault</td>
<td align="right">50</td>
<td align="right">-1</td>
<td align="right">0.66</td>
<td align="right">176.0</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">UrbanPop</td>
<td align="right">50</td>
<td align="right">-1</td>
<td align="right">0.03</td>
<td align="right">57.5</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">UrbanPop</td>
<td align="right">0</td>
<td align="right">-1</td>
<td align="right">0.62</td>
<td align="right">69.0</td>
<td align="right">0.14</td>
</tr>
<tr class="even">
<td align="left">Assault</td>
<td align="right">28</td>
<td align="right">-1</td>
<td align="right">0.35</td>
<td align="right">104.0</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">UrbanPop</td>
<td align="right">28</td>
<td align="right">-1</td>
<td align="right">0.11</td>
<td align="right">58.5</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">UrbanPop</td>
<td align="right">0</td>
<td align="right">-1</td>
<td align="right">0.79</td>
<td align="right">51.5</td>
<td align="right">0.45</td>
</tr>
<tr class="odd">
<td align="left">UrbanPop</td>
<td align="right">22</td>
<td align="right">1</td>
<td align="right">0.26</td>
<td align="right">66.5</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">Assault</td>
<td align="right">22</td>
<td align="right">-1</td>
<td align="right">0.04</td>
<td align="right">243.5</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">Assault</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.64</td>
<td align="right">195.5</td>
<td align="right">0.11</td>
</tr>
</tbody>
</table>
<div id="the-first-4-splits" class="section level3">
<h3>The First 4 Splits</h3>
<center>
<img src="/img/regression.gif" alt="gif" />
</center>
</div>
</div>
<div id="the-constructed-tree" class="section level2">
<h2>The Constructed Tree</h2>
<pre class="r"><code>rpart.plot(RegressionTree)</code></pre>
<p><img src="/post/2018-01-22-decisioin-trees_files/figure-html/unnamed-chunk-18-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="summary" class="section level1">
<h1>Summary</h1>
<p>Next up will be a post on Random Forests. How trees are implemented in the real world.</p>
</div>
<div id="further-reading" class="section level1">
<h1>Further Reading</h1>
<p><a href="https://en.wikipedia.org/wiki/Decision_tree_learning" class="uri">https://en.wikipedia.org/wiki/Decision_tree_learning</a></p>
<p><a href="http://www.stat.cmu.edu/~cshalizi/350-2006/lecture-10.pdf" class="uri">http://www.stat.cmu.edu/~cshalizi/350-2006/lecture-10.pdf</a></p>
<p><a href="https://datajobs.com/data-science-repo/Decision-Trees-%5BRokach-and-Maimon%5D.pdf" class="uri">https://datajobs.com/data-science-repo/Decision-Trees-[Rokach-and-Maimon].pdf</a></p>
<p><a href="http://www.stat.wisc.edu/~loh/treeprogs/guide/wires11.pdf" class="uri">http://www.stat.wisc.edu/~loh/treeprogs/guide/wires11.pdf</a></p>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-breiman1984classification">
<p>Breiman, Leo, Jerome Friedman, Charles J Stone, and Richard A Olshen. 1984. <em>Classification and Regression Trees</em>. CRC press.</p>
</div>
<div id="ref-friedman2001elements">
<p>Friedman, Jerome, Trevor Hastie, and Robert Tibshirani. 2001. <em>The Elements of Statistical Learning</em>. Vol. 1. Springer series in statistics New York.</p>
</div>
</div>
</div>

    </div>

    


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/data-analysis">Data Analysis</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/tutorial">Tutorial</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/decision-trees">Decision Trees</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/r">R</a>
  
</div>




    
    

    

    
<section id="comments">
  <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "@disqus_xZMQc2VwQ8" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



  </div>
</article>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    
    <script id="dsq-count-scr" src="//@disqus_xZMQc2VwQ8.disqus.com/count.js" async></script>
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML" integrity="sha512-tOav5w1OjvsSJzePRtt2uQPFwBoHt1VZcUq8l8nm5284LEKE9FSJBQryzMBzHxY5P0zRdNqEcpLIRVYFNgu1jw==" crossorigin="anonymous"></script>
    
    

  </body>
</html>

